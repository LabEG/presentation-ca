<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>reveal.js</title>

		<link rel="stylesheet" href="dist/reset.css">
		<link rel="stylesheet" href="dist/reveal.css">
		<link rel="stylesheet" href="dist/theme/white.css">

		<!-- Theme used for syntax highlighted code -->
		<link rel="stylesheet" href="plugin/highlight/github-dark-dimmed.css">
	</head>
	<body>
		<div class="reveal">
			<div class="slides">

				<section>
					<section>
						<h4>
							<span style="color: #ff0032">
								Зачем фронтенду чистая архитектура, <br />
								и как она помогает строить микросервисы и микрофронтенды
							</span>
						</h4>
						<br>
						<p>
							Евгений Лабутин
						</p>
						<small>
							МТС Твой бизнес
						</small>
					</section>

					<section>
						<img style="width: 30rem;" src="./images/qr/qr-to-holyjs-2023.png" />
					</section>
				</section>

				<section>
					<section>
						<h3>
							О себе
						</h3>
						<p>
							Fullstack разработчик, стаж 10+ лет
						</p>
						<ul>
							<li>
								Web - React + Typescript
							</li>
							<li>
								Server - C# + Asp.Net
							</li>
							<li>
								Android Native, iOS Native - C# + Xamarin
							</li>
							<li>
								Android, iOS - React Native
							</li>
							<li>
								Desktop - C# Windows, Linux, MacOS
							</li>
							<li>
								Unity 3D - C#
							</li>
						</ul>
					</section>

					<section>
						<small>
							Интерактивные доски для школ Москвы с удаленным управлением
						</small>
						<div style="position: relative; height: 40rem;">
							<img style="position: absolute; transform: translateX(-50%);" class="fragment fade-in-then-out" src="https://labeg.ru/images/portfolio/avilex/schools_01.png" />
							<img style="position: absolute; transform: translateX(-50%);" class="fragment fade-in-then-out" src="https://labeg.ru/images/portfolio/avilex/schools_02.png" />
							<img style="position: absolute; transform: translateX(-50%);" class="fragment fade-in-then-out" src="https://labeg.ru/images/portfolio/avilex/schools_03.png" />
						</div>
					</section>

					<section>
						<small>
							МФЦ Москвы
						</small>
						<div style="position: relative; height: 40rem;">
							<img style="position: absolute; transform: translateX(-50%);" class="fragment fade-in-then-out" src="https://labeg.ru/images/portfolio/avilex/terminal_menu.jpg" />
							<img style="position: absolute; transform: translateX(-50%);" class="fragment fade-in-then-out" src="https://labeg.ru/images/portfolio/avilex/mfc_04.png" />
							<img style="position: absolute; transform: translateX(-50%);" class="fragment fade-in-then-out" src="https://labeg.ru/images/portfolio/avilex/mfc_02.png" />
							<img style="position: absolute; transform: translateX(-50%);" class="fragment fade-in-then-out" src="https://labeg.ru/images/portfolio/avilex/mfc_01.png" />
							<img style="position: absolute; transform: translateX(-50%);" class="fragment fade-in-then-out" src="./images/portfolio/mfc_pads.jpg" />
						</div>
					</section>

					<section>
						<small>
							ООО Восток уголь
						</small>
						<div style="position: relative; height: 40rem;">
							<img style="position: absolute; transform: translateX(-50%);" class="fragment fade-in-then-out" src="https://labeg.ru/images/portfolio/avilex/vu_01.jpg" />
						</div>
					</section>

					<section>
						<small>
							МТС Маркетолог (на старте)
						</small>
						<div style="position: relative; height: 40rem;">
							<img style="position: absolute; transform: translateX(-50%);" class="fragment fade-in" src="https://labeg.ru/images/portfolio/stream/marketolog_01.png" />
						</div>
					</section>

					<section>
						<small>
							МТС Опросник
						</small>
						<div style="position: relative; height: 40rem;">
							<img style="position: absolute; transform: translateX(-50%);" class="fragment fade-in" src="https://labeg.ru/images/portfolio/stream/questioner_01.png" />
						</div>
					</section>

					<section>
						<small>
							МТС Профиль (на старте)
						</small>
						<div style="position: relative; height: 40rem;">
							<img style="position: absolute; transform: translateX(-50%);" class="fragment fade-in-then-out" src="https://labeg.ru/images/portfolio/stream/profile_01.png" />
							<img style="position: absolute; transform: translateX(-50%);" class="fragment fade-in-then-out" src="https://labeg.ru/images/portfolio/stream/profile_02.png" />
							<img style="position: absolute; transform: translateX(-50%);" class="fragment fade-in-then-out" src="https://labeg.ru/images/portfolio/stream/profile_03.png" />
						</div>
					</section>

					<section>
						<small>
							МТС Дети
						</small>
						<div style="position: relative; height: 40rem;">
							<img style="position: absolute; transform: translateX(-50%);" class="fragment fade-in-then-out" src="https://labeg.ru/images/portfolio/stream/kids_03.png" />
							<img style="position: absolute; transform: translateX(-50%);" class="fragment fade-in-then-out" src="https://labeg.ru/images/portfolio/stream/kids_02.png" />
						</div>
					</section>

					<section>
						<h4>
							... а также учавствовал в
						</h4>
						<p class="fragment fade-in">
							Главный сайт <span style="color: #ff0032">МТС</span>
						</p>
						<p class="fragment fade-in">
							Личный кабинет <span style="color: #ff0032">МТС</span>
						</p>
						<p class="fragment fade-in">
							Сервер интеграции Скайп для Бизнеса
						</p>
						<p class="fragment fade-in">
							<span style="color: #ff0032">МТС</span> Твой бизнес
						</p>
						<p class="fragment fade-in">
							... и прочее
						</p>
					</section>

					<section>
						<h3>
							К чему все эти проекты здесь?
						</h3>
					</section>

					<section>
						<h3>
							Все проекты сделаны на
							<span style="color: #ff0032">Чистой Архитектуре</span>
						</h3>
					</section>
				</section>

				<section>
					<p>
						Часть 1
					</p>
					<h3>
						<span style="color: #ff0032">
							Чистая архитектура
						</span>
					</h3>
					<p>
						&nbsp;
					</p>
				</section>

				<section>
					<section>
						<h3>
							Для кого ???
						</h3>

						<p class="fragment">
							Для тех кто хочет делать веб приложения не уступающие дестопным по
							<span class="fragment highlight-red">сложности</span> и
							<span class="fragment highlight-red">производительности</span>!
						</p>
					</section>

					<section>
						<small>
							Не уступающие Libre Office и MS Office
						</small>
						<div style="position: relative; height: 40rem;">
							<img style="position: absolute; transform: translateX(-50%);" src="./images/sample-office.jpeg" />
						</div>
					</section>

					<section>
						<small>
							Не уступающие 3ds Max и Autocad
						</small>
						<div style="position: relative; height: 40rem;">
							<img style="position: absolute; transform: translateX(-50%);" src="./images/sample-3ds-max.jpg" />
						</div>
					</section>

					<section>
						<small>
							Не уступающие Photoshop и CorelDraw
						</small>
						<div style="position: relative; height: 40rem;">
							<img style="position: absolute; transform: translateX(-50%);" src="./images/sample-photoshop.png" />
						</div>
					</section>

					<section>
						<h3>
							А также миллиону других <span style="color: #ff0032">сложных</span> приложений!
						</h3>
					</section>

				</section>

				<section>
					<section>
						<h3>
							Что такое <br />
							<span style="color: #ff0032">Чистая Архитектура</span> ?
						</h3>
					</section>

					<section>
						<h3>
							Это книга-<span style="color: #ff0032">бестселлер</span>
						</h3>
						<img style="height: 32rem;" src="./images/book-ca.webp" />
					</section>

					<section>
						<h3>
							Еще почитать...
						</h3>
						<a href="https://www.ozon.ru/product/microsoft-net-arhitektura-korporativnyh-prilozheniy-saltarello-andrea-espozito-dino-589420364/?oos_search=false&sh=L1bXAKLN7g" target="_blank">
							<img style="height: 32rem;" src="./images/books/dino-architect.png" />
						</a>
						<a href="https://devblogs.microsoft.com/dotnet/dotnet-maui-ebook-released/" target="_blank">
							<img style="height: 32rem;" src="./images/books/maui.png" />
						</a>
					</section>

				</section>

				<section>
					<section>
						<h3>
							Что дает <span style="color: #ff0032">Чистая Архитектура</span> ?
						</h3>
						<p class="fragment">
							<small>
								<b>Независимость от фреймворка.</b> Архитектура не зависит от существования
								какой-либо библиотеки. Это позволяет использовать фреймворк в качестве
								инструмента, вместо того, чтобы втискивать свою систему
								в рамки его ограничений.
							</small>
						</p>
						<p class="fragment">
							<small>
								<b>Тестируемость.</b> Бизнес-правила могут быть протестированы
								без пользовательского интерфейса, базы данных, веб-сервера или любого
								другого внешнего компонента.
							</small>
						</p>
						<p class="fragment">
							<small>
								<b>Независимоcть от UI.</b> Пользовательский интерфейс можно легко изменить,
								не изменяя остальную систему. Например, веб-интерфейс может быть
								заменен на консольный, без изменения бизнес-правил.
							</small>
						</p>
						<p class="fragment">
							<small>
								<b>Независимоcть от базы данных.</b> Вы можете поменять Oracle или SQL Server
								на MongoDB, BigTable, CouchDB или что-то еще. Ваши бизнес-правила
								не связаны с базой данных.
							</small>
						</p>
						<p class="fragment">
							<small>
								<b>Независимость от какого-либо внешнего сервиса.</b> По факту ваши бизнес
								правила просто ничего не знают о внешнем мире.
							</small>
						</p>
					</section>
				</section>

				<section>
					<section>
						<h3>
							Где уже используется?
						</h3>
					</section>

					<section>
						<h3>
							Серверное ПО
						</h3>
						<ul>
							<li class="fragment">
								C# Asp.Net
							</li>
							<li class="fragment">
								Javascript Nest.js
							</li>
							<li class="fragment">
								Java Spring
							</li>
							<li class="fragment">
								PHP Yii, Symphony, Laravel
							</li>
							<li class="fragment">
								и менее популярные...
							</li>
						</ul>
					</section>

					<section>
						<h3>
							Мобильное и Десктопное ПО
						</h3>
						<ul>
							<li class="fragment">
								Android Java, Kotlin, C#
							</li>
							<li class="fragment">
								iOS Objective-C, Swift, C#
							</li>
							<li class="fragment">
								WPF, WinForms, Gtk
							</li>
							<li class="fragment">
								Xamarin
							</li>
							<li class="fragment">
								и менее популярные...
							</li>
						</ul>
					</section>

					<section>

						<h3>
							Использование в вебе
						</h3>
						<ul>
							<li class="fragment">
								<a href="https://github.com/microsoft/vscode/tree/main/src/vs/editor/common" target="_blank">
									VS Code
								</a>
							</li>
							<li class="fragment">
								<a href="https://nestjs.com/" target="_blank">
									NestJS
								</a>
							</li>
							<li class="fragment">
								<a href="https://angular.io/" target="_blank">
									Angular
								</a>
								<span class="fragment" style="color: #ff0032">- но плохо</span>
							</li>
							<li class="fragment">
								и менее популярные...
							</li>
						</ul>
					</section>
				</section>

				<section>
					<section>
						<h3>
							Слои
						</h3>
						<p class="fragment">
							<small>
								<b style="color: #ff0032">View</b>
								- содежит верстку и выводит данные пользователю, не должен содержать логики
							</small>
						</p>
						<p class="fragment">
							<small>
								<b style="color: #ff0032">Controller</b>
								- отвечает за обработку событий от пользователя, клики, скролы и т.п.
							</small>
						</p>
						<p class="fragment">
							<small>
								<b style="color: #ff0032">Service</b>
								- отвечает за хранение логики переиспользуемой между разными контроллерами
							</small>
						</p>
						<p class="fragment">
							<small>
								<b style="color: #ff0032">Repository</b>
								- отвечает за получение данных из внешних источников, такие как api, базы данных и пр.
							</small>
						</p>
						<p class="fragment">
							<small>
								<b style="color: #ff0032">Models</b>
								- отвечает за перенос данных между слоями и содержит бизнес логику для этих данных
							</small>
						</p>
					</section>

					<section>
						<h3>
							Связи слоев
						</h3>
						<img style="height: 34rem" src="./images/layers.png" />
					</section>
				</section>

				<section>
					<section>
						<h3>
							Слой <b style="color: #ff0032">View</b>
						</h3>
						<p>
							Представляет из себя функциональный компонент или метод render классового компонента без логики
						</p>
					</section>

					<section>
						<h4>
							Пример слоя <b style="color: #ff0032">View</b> в React
						</h4>

						<pre><code data-trim data-noescape class="language-ts"><script type="text/template">
							const Comment = (props) => (
								<div className="сomment">
									<div className="user-info">
										<img
											className="avatar"
											src={props.author.avatarUrl}
											alt={props.author.name}
										/>
										<div className="user-info-name">{props.author.name}</div>
									</div>
									<div className="comment-text">{props.text}</div>
									<div className="comment-date">{props.date}</div>
								</div>
							);
						</script></code></pre>
					</section>
				</section>

				<section>
					<section>
						<h3>
							Слой <b style="color: #ff0032">Controller</b>
						</h3>
						<p>
							Представляет из себя класс отвечающий за взаимодействие с событиями от пользователя
							и предоставления данных для отображения в слое view.
						</p>
					</section>

					<section>
						<h4>
							Пример слоя <b style="color: #ff0032">Controller</b> в React
						</h4>

						<pre><code data-trim data-noescape class="language-ts" data-line-numbers="|3-4|6-12|"><script type="text/template">
							class ToDoController {

								public currentTodo: string = "";
								public todos: string[] = [];

								public handleAddTodo (): void {
									this.todos.push(this.currentTodo);
								}

								public handleDeleteTodo (index: number): void {
									this.todos.splice(index, 1);
								}

							}
						</script></code></pre>
					</section>

					<section>
						<h4>
							Пример слоя <b style="color: #ff0032">Controller</b> в C#, Java, Xamarin, WPF, Asp.Net
						</h4>

						<pre><code data-trim data-noescape class="language-ts"><script type="text/template">
							class ToDoController
							{
								public string CurrentTodo = "";
								public List<string> Todos = new List<string>();

								public void HandleAddTodo() {
									this.Todos.Add(this.CurrentTodo);
								}

								public void HandleDeleteTodo(int index) {
									this.Todos.RemoveAt(index);
								}
							}
						</script></code></pre>
					</section>
				</section>


				<section>
					<section>
						<h3>
							Связывание слоев <b style="color: #ff0032">View</b> и <b style="color: #ff0032">Controller</b>
						</h3>
					</section>

					<section>
						<h4>
							1. Через классовый компонент
						</h4>

						<pre><code data-trim data-noescape class="language-ts" data-line-numbers="0"><script type="text/template">
							export const todoView = (ctrl: ToDo, props) => (
								<div className="comment">
									<button onClick={() => ctrl.handleAddTodo()}>
										Кнопка
									</button>
								</div>
							);
						</script></code></pre>

						<pre><code data-trim ata-noescape class="language-ts" data-line-numbers="|7-9|"><script type="text/template">
							import {todoView} from "ToDo.view.tsx";

							class ToDo extends React.Component {

								...

								public render (): JSX.Element {
									return todoView(this, this.props);
								}
							}
						</script></code></pre>

					</section>

					<section>
						<h4>
							2. Библиотека <a href="https://github.com/LabEG/reca" target="_blank">ReCA</a>
						</h4>

						<pre><code data-trim data-noescape class="language-ts" data-line-numbers="|3|"><script type="text/template">
							import {AutoStore} from "reca";

							class ToDoStore extends AutoStore {
								...
							}
						</script></code></pre>

						<pre><code data-trim data-noescape class="language-ts" data-line-numbers="|4|"><script type="text/template">
							import {useStore} from "reca";

							const TodoView = (props) => {
								const store = useStore(ToDoStore);

								return (
									<div className="Comment">
										<button onClick={store.handleAddTodo}>
											Кнопка
										</button>
									</div>
								)
							};
						</script></code></pre>
					</section>

					<section>
						<h4>
							3. Библиотека MobX
						</h4>

						<pre><code data-trim data-noescape class="language-ts" data-line-numbers="|5|"><script type="text/template">
							class ToDoStore {
								...
							}

							export const todoStore = new TodoStore();
						</script></code></pre>

						<pre><code data-trim data-noescape class="language-ts" data-line-numbers="|3|11|"><script type="text/template">
							import {todoStore} from "./ToDo.store.ts";

							const Todo = observer(({todoStore}) => (
								<div className="Comment">
									<button onClick={() => toDoStore.handleAddTodo()}>
										Кнопка
									</button>
								</div>
							));

							ReactDOM.render(<Todo todoStore={todoStore} />, body)
						</script></code></pre>
					</section>
				</section>


				<section>
					<section>
						<h3>
							Слой <b style="color: #ff0032">Services</b>
						</h3>
						<p>
							Представляет из себя класс содержащий логику пере используемую
							несколькими контроллерами.
						</p>
					</section>

					<section>
						<h4>
							Пример слоя <b style="color: #ff0032">Service</b>
						</h4>

						<p>
							Логика запроса профиля пользователя.
						</p>

						<pre><code data-trim data-noescape class="language-ts"><script type="text/template">
							class ProfileService
							{
								public async getUserProfile(): Promise<UserProfile> {
									const response = await fetch("/api/profile");
									const data = await response.json();

									...

									return data;
								}
							}
						</script></code></pre>
					</section>

					<section>
						<h4>
							Пример слоя <b style="color: #ff0032">Service</b>
						</h4>

						<p>
							Сборка логов.
						</p>

						<pre><code data-trim data-noescape class="language-ts"><script type="text/template">
							class LoggerService
							{
								public log(): void {
									...
								}

								public warn(): void {
									...
								}

								public error(): void {
									...
								}
							}
						</script></code></pre>
					</section>

					<section>
						<h4>
							Что еще размещается в <b style="color: #ff0032">Service</b>?
						</h4>

						<ul>
							<li>
								Запросы к API сервера
							</li>
							<li>
								Сервис Логирования
							</li>
							<li>
								Сервис GTM
							</li>
							<li>
								Сервис Кеширования
							</li>
							<li>
								Сервис Шина Событий
							</li>
							<li>
								Сервис Веб-Сокетов
							</li>
							<li>
								Сервис Нотификаций
							</li>
							<li>
								И любой другой пере используемый код, кроме логики данных, но об этом позже.
							</li>
						</ul>
					</section>

					<section>
						<h4>
							Пример преимущества слоя <b style="color: #ff0032">Service</b>
						</h4>

						<pre><code data-trim data-noescape class="language-ts"><script type="text/template">
							class ProfileService
							{
								references: 27
								public async getUserProfile(): Promise<UserProfile> {
									...
									Версия 1: Получение собственного профиля,
									Версия 2: Получение собственного и обогащение профилем ССО,
									Версия 3: Получение профиля с бека с поддержкой openID
									...
								}
							}
						</script></code></pre>

						<small>
							Сервис запроса профиля пере используется в 27 местах. Сервис приходилось править 3 раза.
							За счет того что вся логика в одном месте править пришлось всего в 1 месте 3 раза, а не в 27 местах по 3 раза.
						</small>
					</section>

					<section>
						<h4>
							Бонус про <b style="color: #ff0032">Service</b>
						</h4>

						<ul>
							<li>
								<b>Независим от фреймворка</b>
								<br/>
								Можно переиспользовать между разными фреймворками в рамках одного приложения
							</li>

							<br/>

							<li class="fragment">
								<b>Независим от платформы</b>
								<br/>
								Можно переиспользовать между разными платформами
							</li>
						</ul>
					</section>
				</section>


				<section>
					<section>
						<h3>
							Связывание слоев <b style="color: #ff0032">Controller</b> и <b style="color: #ff0032">Service</b>
						</h3>
						<p>
							Для связывания используются библиотеки Dependency Injection
						</p>
					</section>

					<section>
						<h4>
							1. Библиотека <a href="https://github.com/LabEG/first-di" target="_blank">First DI</a> и
							<a href="https://github.com/LabEG/reca" target="_blank">ReCA</a>
						</h4>

						<pre><code data-trim ata-noescape class="language-ts"><script type="text/template">
							import {reflection} from "first-di";

							export class ProfileService
							{
								public async getUserProfile(): Promise<UserProfile> {...}
							}
						</script></code></pre>

						<pre><code data-trim data-noescape class="language-ts" data-line-numbers="|4|6|"><script type="text/template">
							import {reflection} from "first-di";
							import {AutoStore} from "reca";

							@reflection
							class ToDoController extends AutoStore {
								constructor (readonly profileService: ProfileService){
									super();
								}
								...
							}
						</script></code></pre>
					</section>

					<section>
						<h4>
							2. Библиотека <a href="https://github.com/typestack/typedi" target="_blank">Type DI</a> и
							классовый компонент
						</h4>

						<pre><code data-trim ata-noescape class="language-ts"><script type="text/template">
							import {Service} from "typedi";

							@Service
							export class ProfileService
							{
								public async getUserProfile(): Promise<UserProfile> {...}
							}
						</script></code></pre>

						<pre><code data-trim data-noescape class="language-ts"><script type="text/template">
							import {Container} from "typedi";

							class ToDoController extends React.Component {
								readonly profileService = Container.get(ProfileService);
							}
						</script></code></pre>
					</section>

					<section>
						<h4>
							Пример контроллера использующего сервисы на
							<a href="https://github.com/LabEG/reca" target="_blank">ReCA</a>
						</h4>

						<pre><code data-trim data-noescape class="language-ts" data-line-numbers="|3-4|9|11|"><script type="text/template">
							class ToDoStore<P> extends AutoStore<P> {
								public constructor (
									private readonly profileService: ProfileService,
									private readonly loggerService: LoggerService
								) {...}

								public async fetchProfile(): Promise<void> {
									try {
										this.profile = await this.profileService.getProf();
									} catch (error: unknown) {
										this.loggerService.error("Error in ToDo", error);
									}
								}
							}
						</script></code></pre>
					</section>
				</section>


				<section>
					<section>
						<h3>
							Слой <b style="color: #ff0032">Repository</b>
						</h3>
						<p>
							Представляет из себя класс содержащий логику запросов данных к системе хранения: API, DB, Storages, Memory.
						</p>
						<small>
							Кроме WebSocket и WebTransport, они остаются в Services.
						</small>
					</section>

					<section>
						<h4>
							Пример слоя <b style="color: #ff0032">Repository</b>
						</h4>

						<p>
							Логика запроса профиля пользователя.
						</p>

						<pre><code data-trim data-noescape class="language-ts"><script type="text/template">
							@reflection
							class ProfileRepository
							{
								public async getUserProfile(): Promise<UserProfile> {
									const response = await fetch("/api/profile");
									const data: unknown = await response.json();

									if (typeof data === "object" && data !== null) {
										return new UserProfile().fromJSON(data);
									}

									throw new Error("Wrong return type");
								}
							}
						</script></code></pre>
					</section>

					<section>
						<h4>
							А почему не в <b style="color: #ff0032">Service</b>???
						</h4>

						<pre><code data-trim data-noescape class="language-ts"><script type="text/template">
							@reflection
							class ProfileService
							{
								constructor (
									private readonly profileRepo: ProfileRepository
								) {}

								public async getUserProfile(): Promise<UserProfile> {
									const profile = await this.profileRepo.getUserProfile();
									// логика обработки данных

									return profile;
								}
							}
						</script></code></pre>

						<small>
							Логика и метод хранения данных не должны зависеть друг от друга.
						</small>

					</section>
				</section>


				<section>
					<section>
						<h3>
							Слой <b style="color: #ff0032">Models</b>
						</h3>
						<p>
							Представляет из себя объект данных с набором свойств и методов.
						</p>
						<small>
							В зависимости от места использования делятся на DTO, Domain Models, View Models, Entities.
						</small>
					</section>

					<section>
						<h4>
							Пример слоя <b style="color: #ff0032">Models</b>
						</h4>

						<small>
							Бизнес модель данных пользователя.
						</small>

						<pre><code data-trim data-noescape class="language-ts" data-line-numbers="|2-4|6-8|10-13|"><script type="text/template">
							class UserProfile {
								public firstName: string = '';
								public familyName: string = '';
								public birthdate: Date = new Date();

								public getFullName(): string {
									return [this.firstName,this.familyName].join(' ');
								}

								public getAge(): number {
									return new Date().getFullYear() -
										this.birthdate.getFullYear();
								}
							}
						</script></code></pre>
					</section>

					<section>
						<h4>
							Десериализация <b style="color: #ff0032">Models</b> через
							<a href="https://github.com/LabEG/Serializable" target="_blank">Serializable</a>
						</h4>

						<small>
							Создание структуры данных из последовательности байтов.
						</small>

						<pre><code data-trim data-noescape class="language-ts"><script type="text/template">
							import { jsonProperty, Serializable } from "ts-serializable";

							class UserProfile extends Serializable {

								@jsonProperty(String)
								public firstName: string = '';

								@jsonProperty(String, null)
								public familyName: string | null = null;

								@jsonProperty(Date)
								public birthdate: Date = new Date();
								...
							}
						</script></code></pre>
					</section>

					<section>
						<h4>
							Сущности из <b style="color: #ff0032">Models</b> через
							<a href="https://typeorm.io/" target="_blank">Type ORM</a>
						</h4>

						<small>
							Создание структуры базы данных из описания моделей.
						</small>

						<pre><code data-trim data-noescape class="language-ts"><script type="text/template">
							import {Entity, Column, Unique} from "typeorm";

							@Entity("user_profiles")
							class UserProfile {

								@PrimaryGeneratedColumn("uuid")
								public id?: string = void 0;

								@Column()
								public firstName: string = '';

								...
							}
						</script></code></pre>
					</section>

					<section>
						<h4>
							Валидация <b style="color: #ff0032">Models</b> через
							<a href="https://github.com/typestack/class-validator" target="_blank">Class Validator</a>
						</h4>

						<small>
							Позволяет валидировать данные используя декораторы.
						</small>

						<pre><code data-trim data-noescape class="language-ts"><script type="text/template">
							import {MaxLength, MinDate} from "class-validator";

							class UserProfile {

								@MaxLength(255, {message: "Максимальная длина 255 символа"})
								public firstName: string = '';

								@MinDate(new Date(1970))
								@MaxDate(new Date())
								public birthdate: Date = new Date();

								...
							}
						</script></code></pre>
					</section>

					<section>
						<h4>
							Преимущества <b style="color: #ff0032">Models</b>
						</h4>

						<small>
							<ul>
								<li>
									<b>Бизнес правила хранятся в независимом от фреймворке месте</b> <br/>
									<em>Пример</em>: Логику формы калькулятора можно заложить в Domain Models и переиспользовать в React и JQuery.
								</li>
								<br/>
								<li class="fragment">
									<b>Бизнес правила можно переиспользовать в разных частях приложения</b> <br/>
									<em>Пример</em>: Логику валидации данных можно использовать и в формах и API.
								</li>
								<br/>
								<li class="fragment">
									<b>Защищают от мутаций и ускоряет код</b> <br/>
									<em>Пример</em>: за счет отсутствия мутаций браузер генерирует лучший машинный код
								</li>
								<br/>
								<li class="fragment">
									<b>Значительно сокращает объем написания кода</b> <br/>
									<em>Пример</em>: за счет того что одни и те же модели переиспользуются в разных местах
								</li>
							</ul>
						</small>
					</section>
				</section>


				<section>
					<section>
						<h3>
							Приложение в сборе
						</h3>
					</section>

					<section>
						<h4>
							Model
						</h4>

						<pre><code data-trim data-noescape class="language-ts"><script type="text/template">
							import { jsonProperty, Serializable } from "ts-serializable";

							class UserProfile extends Serializable {

								@jsonProperty(String)
								public firstName: string = "";

								...

								public getFullName(): string {
									return [this.firstName,this.familyName].join(" ");
								}
							}
						</script></code></pre>
					</section>

					<section>
						<h4>
							View
						</h4>

						<pre><code data-trim data-noescape class="language-ts"><script type="text/template">
							import {useStore} from "reca";
							import {UserStore} from "./UserStore.store.ts";

							const UserProfile = (props) => {
								const store = useStore(UserStore);

								return (
									<div className="UserProfile">
										{store.profile.firstName}

										<button onClick={store.onAddClick}>Добавить</button>
									</div>
								)
							};
						</script></code></pre>
					</section>

					<section>
						<h4>
							Controller
						</h4>

						<pre><code data-trim data-noescape class="language-ts"><script type="text/template">
							import {AutoStore} from "reca";
							@reflection
							export class UserStore extends AutoStore {

								public profile: UserProfile = new UserProfile();

								public constructor (private profileService: ProfileService) {}

								private async fetchProfile(): Promise<void> {
									try {
										this.profile = await this.profileService.getProfile();
									} catch (error: unknown) {...}
								}
							}
						</script></code></pre>
					</section>

					<section>
						<h4>
							Service
						</h4>

						<pre><code data-trim data-noescape class="language-ts"><script type="text/template">
							@reflection
							class ProfileService
							{
								public constructor (
									private readonly profileRepo: ProfileRepository
								) {}

								public async getUserProfile(): Promise<UserProfile> {
									const profile = await this.profileRepo.getUserProfile();
									// логика обработки данных

									return profile;
								}
							}
						</script></code></pre>
					</section>

					<section>
						<h4>
							Repository
						</h4>

						<pre><code data-trim data-noescape class="language-ts"><script type="text/template">
							@reflection
							class ProfileRepository
							{
								public async getUserProfile(): Promise<UserProfile> {
									const response = await fetch("/api/profile");
									const data: unknown = await response.json();

									if (typeof data === "object" && data !== null) {
										return new UserProfile().fromJSON(data);
									}

									throw new Error("Wrong return type");
								}
							}
						</script></code></pre>
					</section>

				</section>


				<section>
					<section>
						<h4>
							Архитектура для веба
						</h4>
						<img style="height: 30rem" src="./images/layers.png" />
					</section>

					<section>
						<h3>
							Чистая архитектура
						</h3>
						<img style="height: 30rem" src="./images/ca/clean-architecture.jpg" />
					</section>

					<section>
						<h4>
							Проблема Redux
						</h4>
						<img style="height: 30rem" src="./images/ca/redux.png" />
					</section>

					<section>
						<h4>
							Решение чистой архитектуры
						</h4>
						<div style="position: relative; height: 30rem;">
							<img style="position: absolute; transform: translateX(-50%);" src="./images/ca/ca-horizontal-0.png" />
							<img style="position: absolute; transform: translateX(-50%);" class="fragment fade-in-then-out" src="./images/ca/ca-horizontal-1.png" />
							<img style="position: absolute; transform: translateX(-50%);" class="fragment fade-in-then-out" src="./images/ca/ca-horizontal-2.png" />
							<img style="position: absolute; transform: translateX(-50%);" class="fragment fade-in-then-out" src="./images/ca/ca-horizontal.png" />
						</div>
					</section>

					<section>
						<div style="position: relative; height: 50rem;">
							<img style="position: absolute; transform: translateX(-50%);" src="./images/ca/sep-part.png" />
							<img style="position: absolute; transform: translateX(-50%);" class="fragment fade-in" src="./images/ca/sep-ful.png" />
						</div>
					</section>
				</section>


				<section>
					<p>
						Часть 2
					</p>
					<h3>
						<span style="color: #ff0032">
							Фронтовые микросервисы
						</span>
					</h3>
					<p>
						&nbsp;
					</p>
				</section>


				<section>
					<section>
						<h3>
							Рост монолита
						</h3>
						<img style="height: 30rem" src="./images/ca/ca-horizontal.png" />
					</section>

					<section>
						<h4>
							Проблемы монолита
						</h4>
						<small>
							<ul>
								<li class="fragment">
									<b>Снижение скорости разработки.</b> Большое монолитное приложение усложняет и замедляет разработку.
								</li>
								<br />
								<li class="fragment">
									<b>Масштабируемость.</b> Невозможно масштабировать отдельные компоненты.
								</li>
								<br />
								<li class="fragment">
									<b>Надежность.</b> Ошибка в одном модуле может повлиять на доступность всего приложения.
								</li>
								<br />
								<li class="fragment">
									<b>Препятствия для внедрения технологий.</b>
									Любые изменения в инфраструктуре или языке разработки влияют на приложение целиком, что зачастую приводит к увеличению стоимости и временных затрат.
								</li>
								<br />
								<li class="fragment">
									<b>Недостаточная гибкость.</b> Возможности монолитных приложений ограничены используемыми технологиями.
								</li>
								<br />
								<li class="fragment">
									<b>Развертывание.</b> При внесении небольшого изменения потребуется повторное развертывание всего монолитного приложения.
								</li>
							</ul>
						</small>
					</section>

					<section>
						<h4>
							Процесс GitFlow
						</h4>
						<div style="position: relative; height: 30rem;">
							<img style="position: absolute; transform: translateX(-50%);" src="./images/processes/process-git-flow.png" />
						</div>
					</section>

					<section>
						<h4>
							Проблема GitFlow
						</h4>
						<div style="position: relative; height: 30rem;">
							<img style="position: absolute; transform: translateX(-50%);" src="./images/processes/gitflow-bottleneck.png" />
						</div>
					</section>

					<section>
						<h3>
							Как решить проблемы?
						</h3>
						<div class="fragment">
							<img style="height: 25rem" src="./images/ca/ca-cut.png" />
							<p>
								Порезать на микросервисы!
							</p>
						</div>
					</section>

					<section>
						<h4>
							Преимущества микросервисов
						</h4>
						<small>
							<ul>
								<li class="fragment">
									<b>Гибкость.</b> Продвигайте гибкие методы работы среди небольших команд, которые регулярно выполняют развертывание.
								</li>
								<br />
								<li class="fragment">
									<b>Гибкое масштабирование.</b> Когда микросервис достигает предельной нагрузки,
									можно быстро выполнить развертывание новых экземпляров данной службы в
									сопутствующем кластере и снизить нагрузку.
									Теперь мы работаем с несколькими держателями и без сохранения состояния,
									а клиенты распределены по различным экземплярам.
									С таким подходом мы можем поддерживать экземпляры гораздо большего размера.
								</li>
								<br />
								<li class="fragment">
									<b>Непрерывное развертывание.</b> Теперь у нас есть регулярные и ускоренные циклы релиза.
									Раньше мы выпускали обновления раз в неделю, а теперь можем делать это примерно два-три раза в день.
								</li>
								<br />
								<li class="fragment">
									<b>Легкость обслуживания и тестирования.</b> Команды могут экспериментировать с новыми функциями и
									возвращаться к предыдущей версии, если что-то не работает.
									Это упрощает обновление кода и ускоряет выпуск новых функций на рынок.
									Кроме того, в отдельных службах легко находить и исправлять ошибки и баги.
								</li>
							</ul>
						</small>
					</section>

					<section>
						<h4>
							Еще преимущества микросервисов
						</h4>
						<small>
							<ul>
								<li class="fragment">
									<b>Независимое развертывание.</b> Микросервисы представляют собой отдельные модули,
									поэтому с ними можно легко и быстро выполнять независимое развертывание отдельных функций.
								</li>
								<br />
								<li class="fragment">
									<b>Гибкость технологий.</b> При использовании архитектуры микросервисов команды могут
									выбирать инструменты с учетом своих предпочтений.
								</li>
								<br />
								<li class="fragment">
									<b>Высокая надежность.</b> Развертывая изменения для конкретной службы, можно не бояться,
									что приложение выйдет из строя целиком.
								</li>
								<br />
								<li class="fragment">
									<b>Довольные команды.</b> Команды работающие с микросервисами
									гораздо лучше отзываются о своей работе благодаря автономности и возможности
									самостоятельно создавать и развертывать приложения, не дожидаясь одобрения запроса pull
									в течение нескольких недель.
								</li>
							</ul>
						</small>
					</section>

					<section>
						<p>
							Большие проекты делаются не большим количеством людей в одной команде,
							а&nbsp;большим количеством маленьких команд.
						</p>
						<small>
							© Роберт Мартин, основатель Agile
						</small>
					</section>

					<section>
						<h4>
							Процесс GitHub Flow
						</h4>
						<div style="position: relative; height: 30rem;">
							<img style="position: absolute; transform: translateX(-50%);" src="./images/processes/process-github-flow.png" />
						</div>
					</section>

					<section>
						<h4>
							Процесс на Микросервисах
						</h4>
						<div style="position: relative; height: 30rem;">
							<img style="position: absolute; transform: translateX(-50%);" src="./images/processes/github-flow-solution.png" />
						</div>
					</section>

				</section>


				<section>
					<section>
						<h3>
							Как выделить <span style="color: #ff0032">микросервис</span>?
						</h3>
						<br/>
						<small>
							<ul>
								<li class="fragment">
									Разделы приложений: Лендинг, Кабинет, Админка, Блог, Справка, Документация
								</li>
								<br/>
								<li class="fragment">
									Изолированные приложения: Промо проекты и промо страницы
								</li>
								<br/>
								<li class="fragment">
									Статика
								</li>
								<br/>
								<li class="fragment">
									Инфраструктурные сервисы: Авторизация, Логи, Мониторинг
								</li>
								<br/>
								<li class="fragment">
									Вспомогательные сервисы: Пререндер, Сниппет, Компоненты, Микрофронтенды
								</li>
							</ul>
						</small>
					</section>
				</section>


				<section>
					<section>
						<h3>
							Схема Микросервисов
						</h3>
						<img style="height: 28rem" src="./images/microservices/microservices.png" />
					</section>
				</section>


				<section>
					<p>
						Часть 3
					</p>
					<h3>
						<span style="color: #ff0032">
							Микрофронтенды
						</span>
					</h3>
					<p>
						&nbsp;
					</p>
				</section>


				<section>
					<section>
						<h3>
							Что такое <span style="color: #ff0032">микрофронтенд</span>?
						</h3>
						<p>
							Микроприложение или виджет динамически встраиваемый в более крупное веб приложение.
						</p>
					</section>

					<section>
						<h4>
							Требования к <span style="color: #ff0032">микрофронтендам</span>
						</h4>
						<small>
							<ul>
								<li class="fragment">
									<b>Независимость от внешнего проекта</b><br/>
									Микрофронтенд должен включать в себя все свои зависимости и быть независим от системы сборки
								</li>
								<br/>
								<li class="fragment">
									<b>Использование микрофреймворков и легковесных библиотек</b><br/>
									React, Angular, Vue - слишком тяжелые. Легкие аналоги Preact, Svelte, SolidJS
								</li>
								<br/>
								<li class="fragment">
									<b>Использовать модули</b><br/>
									Микрофронтенд внедряется в проект посредствам динамического импорта
								</li>
								<br/>
								<li class="fragment">
									<b>Не использовать глобальные переменные</b><br/>
									Глобальные переменные JS или CSS приведут к появлению конфликтов
								</li>
								<br/>
								<li class="fragment">
									<b>Независим от внешних настроек стилей</b><br/>
									Компоненты внутри микрофронтенда должны использовать собственный CSS Reset
								</li>
								<br/>
								<li class="fragment">
									<b>Использовать авторизацию по OpenID</b><br/>
									Авторизация на куках работает в только рамках одного домена
								</li>
							</ul>
						</small>
					</section>
				</section>


				<section>
					<section>
						<h3>
							Создание <span style="color: #ff0032">микрофронтенда</span>
						</h3>
						<p>
							Микрофронтенд представляет из себя js файл с двумя экспортируемыми функциями
							<span style="color: #2c6df9">render</span> и <span style="color: #2c6df9">clear</span>.
						</p>
					</section>

					<section>
						<h4>
							Функция <span style="color: #2c6df9">render</span>
						</h4>

						<small>
							Служит для отрисовки микрофронтенда. Принимает в качестве
							параметров элемент в который необходимо врендерить микрофронтенд и конфиг микрофронтенда
						</small>

						<pre><code data-trim data-noescape class="language-ts"><script type="text/template">
							import ReactDOM from "react-dom";

							let memRootElement: HTMLElement | null = null;

							export const render = (elem: HTMLElement, config?: Config) => {
								try {
									memRootElement = elem;

									ReactDOM.render(<App config={config} />, elem);

								} catch (error: unknown) {
									logger.error("Error on draw widget", error);
								}
							};
						</script></code></pre>
					</section>


					<section>
						<h4>
							Функция <span style="color: #2c6df9">clear</span>
						</h4>

						<small>
							Служит для для зачистки приложения от присутствия микрофронтенда.
						</small>

						<pre><code data-trim data-noescape class="language-ts"><script type="text/template">
							export const clear = (): void => {
								ReactDOM.render([], memRootElement);
							};
						</script></code></pre>
					</section>
				</section>


				<section>
					<section>
						<h3>
							Сборка <span style="color: #ff0032">микрофронтенда</span>
						</h3>
						<p>
							Собирается любым бандлером rollup, webpack, vite, swc и т.п.
						</p>
					</section>

					<section>
						<h4>
							Сборка в Rollup
						</h4>

						<pre><code data-trim data-noescape class="language-ts"><script type="text/template">
							export default {
								input: [
									"src/microfront-first-main.tsx",
									"src/microfront-second-main.tsx"
								],
								plugins: [...],
								output: [
									{
										dir: "dist",
										format: "esm",
										entryFileNames: "[name].esm.min.js",
									}
								]
							};
						</script></code></pre>
					</section>


					<section>
						<h4>
							Сборка в Webpack
						</h4>

						<pre><code data-trim data-noescape class="language-ts"><script type="text/template">
							module.exports = {
								entry: {
									microfrontFirst: "src/microfront-first-main.tsx",
									microfrontSecond: "src/microfront-second-main.tsx"
								},
								plugins: [...],
								output: {
									filename: "[name].esm.min.js",
									path: path.join(__dirname, "dist")
								},
							};
						</script></code></pre>
					</section>
				</section>


				<section>
					<section>
						<h3>
							Подключенuе <span style="color: #ff0032">микрофронтенда</span>
						</h3>
						<small>
							Используется стандартная функция JS - динамический импорт.
							На 2022 год нативную поддержку имеют 96% браузеров.
							Для более старых можно использовать CJS модули и функцию require.
						</small>
					</section>

					<section>
						<h4>
							Подключение через импорт
						</h4>

						<small>
							В Typescript путь должен быть прописан через переменную.
							Иначе будет ругаться на отсутствие тайпингов.
						</small>

						<pre><code data-trim data-noescape class="language-ts"><script type="text/template">
							const microElement = document.querySelector("#micro");

							const path = "https://tb.mts.ru/micro/header.esm.min.js";
							const widget = await import(path);

							widget.render(microElement, {openId: ""});
						</script></code></pre>
					</section>

					<section>
						<h4>
							Костыль для Webpack
						</h4>

						<small>
							Webpack пытается встроить микрофронтенд в сборку.
							Для исправления этого поведения необходимо вынести импорт в скрытую от webpack часть.
						</small>

						<pre><code data-trim data-noescape class="language-ts"><script type="text/template">
							const microElement = document.querySelector("#micro");

							const webpackDynamicImport = new Function(
								"return import('https://tb.mts.ru/micro/header.esm.min.js')"
							);
							const widget = await webpackDynamicImport();

							widget.render(microElement, {openId: ""});
						</script></code></pre>
					</section>

					<section>
						<h4>
							Решение для старых браузеров
						</h4>

						<small>
							Если необходима поддержка старых браузеров необходимо сделать вторую версию микрофронтенда в формате CJS.
							Перед импортом проверять поддержку динамического импорта.
							И импортировать CJS в случае не поддержки динамичесокго импорта.
						</small>

						<pre><code data-trim data-noescape class="language-ts"><script type="text/template">
							const microElement = document.querySelector("#micro");
							let widget = nul;
							try {
								new Function("(async(a=0)=>({...{a}},await import('')))()");

								const path = "https://tb.mts.ru/micro/header.esm.min.js";
								widget = await import(path);

							} catch (err) {
								widget = require("https://tb.mts.ru/micro/header.cjs.min.js");
							}

							widget.render(microElement, {openId: ""});
						</script></code></pre>
					</section>
				</section>


				<section>
					<section>
						<h3>
							Частые ошибки
						</h3><small>
							<ul>
								<li class="fragment">
									<b>Импорт скрипта через script в head</b><br/>
									Неизвестно когда скрипт будет подгружен. Регистрирует глобальные переменные
								</li>
								<br/>
								<li class="fragment">
									<b>Скрипт сам начинает работать</b><br/>
									Скрипт должен начать работу только когда его запустят
								</li>
								<br/>
								<li class="fragment">
									<b>Не учитывается SPA</b><br/>
									В 2022 году большинство приложений это SPA
								</li>
								<br/>
								<li class="fragment">
									<b>Не освобождается память</b><br/>
									При выходе со страницы микрофронтенда память должна быть освобождена
								</li>
							</ul>
						</small>
					</section>
				</section>

				<section>
					<section>
						<div style="position: relative; height: 50rem;">
							<img style="position: absolute; transform: translateX(-50%);" src="./images/ca/sep-ful.png" />
						</div>
					</section>
				</section>

				<section>
					<section>
						<div style="position: relative; height: 50rem;">
							<img style="position: absolute; transform: translateX(-50%);" src="./images/end.jpg" />
						</div>
					</section>

					<section>
						<a href="https://labeg.ru/" target="_blank">labeg.ru</a>
					</section>
				</section>

			</div>
		</div>

		<script src="dist/reveal.js"></script>
		<script src="plugin/notes/notes.js"></script>
		<script src="plugin/markdown/markdown.js"></script>
		<script src="plugin/highlight/highlight.js"></script>
		<script>
			// More info about initialization & config:
			// - https://revealjs.com/initialization/
			// - https://revealjs.com/config/
			Reveal.initialize({
				hash: true,

				// Learn about plugins: https://revealjs.com/plugins/
				plugins: [ RevealMarkdown, RevealHighlight, RevealNotes ]
			});
		</script>
	</body>
</html>
